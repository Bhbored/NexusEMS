@*Reusable User Profile Dropdown Menu*@
@using NexusEMS.Web.Services
@inject AuthService AuthService
@inject NavigationManager Navigation

<div class="dropdown @CssClass">
    <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle text-secondary"
       id="@DropdownId" data-bs-toggle="dropdown" aria-expanded="false">
        @if (ShowIcon)
        {
            <i class="bi bi-person-circle fs-5 me-2"></i>
        }
        <strong>@(Username ?? AuthService.CurrentUser?.Username ?? "User")</strong>
    </a>
    <ul class="dropdown-menu text-small shadow" aria-labelledby="@DropdownId">
        <li><a class="dropdown-item" href="#" @onclick="ViewProfile">
            <i class="bi bi-person me-2"></i>Profile
        </a></li>
        <li><a class="dropdown-item" href="#" @onclick="ViewSettings">
            <i class="bi bi-gear me-2"></i>Settings
        </a></li>
        <li>
            <hr class="dropdown-divider">
        </li>
        <li><a class="dropdown-item" href="#" @onclick="HandleLogout">
            <i class="bi bi-box-arrow-right me-2"></i>Sign out
        </a></li>
    </ul>
</div>

@code {
    [Parameter]
    public string? Username { get; set; }

    [Parameter]
    public bool ShowIcon { get; set; } = true;

    [Parameter]
    public string? CssClass { get; set; }

    [Parameter]
    public string DropdownId { get; set; } = "dropdownUser";

    [Parameter]
    public EventCallback OnLogout { get; set; }

    [Parameter]
    public EventCallback OnProfileClick { get; set; }

    [Parameter]
    public EventCallback OnSettingsClick { get; set; }

    private void HandleLogout()
    {
        AuthService.Logout();
        if (OnLogout.HasDelegate)
        {
            OnLogout.InvokeAsync();
        }
        else
        {
            Navigation.NavigateTo("/login");
        }
    }

    private void ViewProfile()
    {
        if (OnProfileClick.HasDelegate)
        {
            OnProfileClick.InvokeAsync();
        }
        else
        {
            // Default profile action
            Console.WriteLine("View Profile clicked");
        }
    }

    private void ViewSettings()
    {
        if (OnSettingsClick.HasDelegate)
        {
            OnSettingsClick.InvokeAsync();
        }
        else
        {
            // Default settings action
            Console.WriteLine("View Settings clicked");
        }
    }
}
